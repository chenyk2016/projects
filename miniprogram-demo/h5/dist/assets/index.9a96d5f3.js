import"./modulepreload-polyfill.b7f2da20.js";import{l}from"./vendor.f9601b82.js";var g=window.navigator&&navigator.userAgent||"";function o(e){return function(){return e.test(g)}}var m={isChrome:o(/webkit\W.*(chrome|chromium)\W/i),isFirefox:o(/mozilla.*\Wfirefox\W/i),isGecko:o(/mozilla(?!.*webkit).*\Wgecko\W/i),isIE:function(){return navigator.appName==="Microsoft Internet Explorer"?!0:!!o(/\bTrident\b/)},isKindle:o(/\W(kindle|silk)\W/i),isMobile:o(/(iphone|ipod|((?:android)?.*?mobile)|blackberry|nokia)/i),isOpera:o(/opera.*\Wpresto\W|OPR/i),isSafari:o(/webkit\W(?!.*chrome).*safari\W/i),isTablet:o(/(ipad|android(?!.*mobile)|tablet)/i),isTV:o(/googletv|sonydtv/i),isWebKit:o(/webkit\W/i),isAndroid:o(/android/i),isIOS:o(/(ipad|iphone|ipod)/i),isIPad:o(/ipad/i),isIPhone:o(/iphone/i),isIPod:o(/ipod/i),isRedmi:o(/Redmi Note 4X/i),isMiniProgram:o(/miniProgram/i),whoami:function(){return g}};let u={};function h(e){let i=!1;return n=>{if(i)return;i=!0;const s=document.title;console.log("bindBack"),window.history.replaceState({emitBack:1,title:document.title},s,"#event.back"),window.history.pushState({emitBack:0,title:document.title},s,"#event.back"),window.addEventListener("popstate",t=>{t.state&&t.state.emitBack===1&&n&&(console.log("bindBack do cb"),n&&n())},!1)}}function b(e){var i="hidden";i in document?document.addEventListener("visibilitychange",n):"mozHidden"in document?(i="mozHidden",document.addEventListener("mozvisibilitychange",n)):"webkitHidden"in document?(i="webkitHidden",document.addEventListener("webkitvisibilitychange",n)):"msHidden"in document?(i="msHidden",document.addEventListener("msvisibilitychange",n)):"onfocusin"in document?document.onfocusin=document.onfocusout=n:window.onpageshow=window.onpagehide=window.onfocus=window.onblur=n;function n(s){let t="visible",a="hidden",r={focus:t,focusin:t,pageshow:t,blur:a,focusout:a,pagehide:a};s=s||window.event;let c="";s.type in r?c=r[s.type]:c=document[i]?"hidden":"visible",e(s,c)}}function f(e){window.addEventListener("hashchange",()=>{try{const i=l.parse(decodeURIComponent(location.hash).slice(1));console.log("hashchange",location),i.type==="mini_to_h5"&&(i.data=JSON.parse(i.data),console.log("getMsg mini_to_h5",i),history.back(),e&&e(i.data))}catch(i){console.log(i)}})}function p(e,i){if(!e)return;let{origin:n,pathname:s,search:t="?",hash:a="#"}=location;t=l.parse(t.slice(1))||{},t.t=Date.now(),t=`?${l.stringify(t)}`;const r={type:"h5_to_mini",data:JSON.stringify({action:e,params:i})};a=`#${l.stringify(r)}`;const c=`${n+s+t+a}`;console.log("sendMsg",c,r),location.replace(c)}u={emit(){},goBack(){m.isMiniProgram()?window.wx.miniProgram.navigateBack():history.go(-1)},goto(e,i){let n="navigateTo";i.__replace&&(n="redirectTo"),m.isMiniProgram()?window.wx.miniProgram[n]({url:`/pages/web-view/index?url=${encodeURIComponent(e)}`,complete(){console.log(`bridge goto[${e}] complete`)},success(){console.log(`bridge goto[${e}] success`)},fail(){console.log("bridge goto: fail"),alert(`bridge goto[${e}] fail`)}}):window.location=e},bindBackCb:null,bindBack:h(),onPageVisibilityChange:b,bindGetMsgFromMini(e){f(e)},sendMsgToMini:p};var d=u;document.querySelector("#root").innerHTML=`
  <h2>web-view bridge\u529F\u80FD\u6D4B\u8BD5</h2>

  <h3 id="bind-back">\u7ED1\u5B9Aback\u6309\u94AE1</h3>

  <h3 id="send-msg">\u5411\u5C0F\u7A0B\u5E8F\u53D1\u9001\u6D88\u606F</h3>

  <h3 id="to-test">\u8DF3\u8F6C\u5176\u4ED6H5</h3>

  <h3 id="back-btn">\u5C0F\u7A0B\u5E8F\u56DE\u9000</h3>
`;document.querySelector("#bind-back").addEventListener("click",()=>{d.bindBack(()=>{d.goto("https://test.com:3000/test/index.html",{__replace:!0})})});document.querySelector("#send-msg").addEventListener("click",()=>{d.sendMsgToMini("btn-click","\u6211\u88AB\u70B9\u51FB\u4E86")});document.querySelector("#back-btn").addEventListener("click",()=>{console.log("#back-btn"),d.goBack()});document.querySelector("#to-test").addEventListener("click",()=>{d.goto("https://test.com:3000/test/index.html")});window.onload=()=>{d.onPageVisibilityChange((e,i)=>{console.log(`: ${e.type}, ${i}`)}),d.bindGetMsgFromMini(e=>{console.log("getMsgFromMini",e)}),window.addEventListener("popstate",e=>{console.log("popstate 1111",e)},!1)};
